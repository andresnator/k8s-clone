name: Branch Flow Enforcer

on:
  pull_request:
    branches:
      - main

jobs:
  verify-source-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Source Branch
        run: |
          BRANCH="${{ github.head_ref }}"
          if [[ "$BRANCH" == "develop" ]] || [[ "$BRANCH" =~ ^hotfix/ ]] || [[ "$BRANCH" =~ ^bugfix/ ]]; then
            echo "✅ Branch validation passed: $BRANCH"
            exit 0
          else
            echo "❌ Error: The main branch only accepts Pull Requests from 'develop', 'hotfix/*' or 'bugfix/*' branches."
            echo "Your current branch is: $BRANCH"
            echo "Please merge your changes into an allowed branch first."
            exit 1